<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Turtle Rush</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Sniglet:wght@400;800&family=Titan+One&display=swap');

  /* --- 1. General Styles --- */
  body {
    margin: 0; overflow: hidden;
    font-family: 'Sniglet', cursive;
    background-color: #222;
    display: flex; justify-content: center; align-items: center;
    height: 100vh; touch-action: none; letter-spacing: 1px;
  }

  /* --- 2. Game Container --- */
  #game-container {
    position: relative;
    width: 100%; max-width: 450px;
    height: 100%; max-height: 850px;
    background: linear-gradient(to bottom, 
        #87CEEB 0%,   /* Sky */
        #E0F6FF 40%,  /* Horizon */
        #48D1CC 40%,  /* Water Surface */
        #40E0D0 60%,  /* Turquoise */
        #008B8B 100%  /* Deep Teal */
    );
    overflow: hidden;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    border-radius: 20px;
  }

  /* --- 3. Atmosphere --- */
  #sky-deco-layer { position: absolute; top: 0; left: 0; width: 100%; height: 40%; z-index: 1; pointer-events: none; }
  .sun {
      position: absolute; top: 10%; right: 10%; width: 60px; height: 60px; background: #FFD700;
      border-radius: 50%; box-shadow: 0 0 40px #FFA500; animation: sunPulse 4s infinite alternate;
  }
  @keyframes sunPulse { 0% { transform: scale(1); opacity: 0.9; } 100% { transform: scale(1.1); opacity: 1; } }
  .cloud {
      position: absolute; background: #fff; border-radius: 50%; opacity: 0.9;
      box-shadow: #fff 15px 8px 0 -5px, #fff 5px 15px 0 -5px, #fff -15px 8px 0 -5px;
      animation: cloudDrift 30s linear infinite;
  }
  .c1 { width: 40px; height: 25px; top: 15%; left: -10%; animation-duration: 35s; }
  .c2 { width: 55px; height: 35px; top: 8%; left: -30%; animation-duration: 45s; animation-delay: 5s; }
  .c3 { width: 30px; height: 20px; top: 20%; left: -50%; animation-duration: 25s; animation-delay: 2s; }
  @keyframes cloudDrift { from { transform: translateX(0); } to { transform: translateX(500px); } }

  /* --- 4. Ocean --- */
  #ocean-deco-layer { position: absolute; top: 40%; left: 0; width: 100%; bottom: 0; z-index: 2; overflow: hidden; pointer-events: none; }
  .sun-reflection {
      position: absolute; top: 0; right: 10%; width: 60px; height: 100%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.3) 0%, transparent 100%); filter: blur(4px);
  }
  .wave-texture { position: absolute; top: 0; left: 0; width: 200%; height: 100%; background-repeat: repeat; }
  .wave-texture-1 {
      background-image: repeating-radial-gradient(circle at 50% 100%, transparent 0, transparent 25px, rgba(255, 255, 255, 0.1) 26px, transparent 28px);
      background-size: 80px 50px; animation: waveDrift 15s linear infinite;
  }
  .wave-texture-2 {
      background-image: repeating-radial-gradient(circle at 50% 100%, transparent 0, transparent 15px, rgba(255, 255, 255, 0.15) 16px, transparent 18px);
      background-size: 50px 30px; top: 10px; animation: waveDrift 8s linear infinite reverse;
  }
  @keyframes waveDrift { from { transform: translateX(0); } to { transform: translateX(-100px); } }

  .little-fish {
      position: absolute; width: 14px; height: 7px; background: #FFD700; border-radius: 50%; opacity: 0.8;
      animation: fishSwim 10s linear infinite alternate; z-index: 3;
  }
  .little-fish::after { content: ''; position: absolute; right: -3px; top: 1px; border-left: 4px solid #FFD700; border-top: 3px solid transparent; border-bottom: 3px solid transparent; }
  .lf1 { top: 20%; left: 10%; animation-duration: 12s; }
  .lf2 { top: 40%; left: 60%; animation-duration: 15s; animation-direction: alternate-reverse; }
  .lf3 { top: 70%; left: 30%; animation-duration: 18s; }
  .lf4 { top: 85%; left: 80%; animation-duration: 20s; animation-direction: alternate-reverse;}
  @keyframes fishSwim { 0% { transform: translateX(0); } 100% { transform: translateX(50px); } }

  /* --- 5. Bridge --- */
  #bridge-area { position: absolute; top: 0; left: 10%; right: 10%; bottom: 0; z-index: 5; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3)); }
  .rope {
    position: absolute; top: 0; bottom: 0; width: 14px; background-color: #8b5a2b; z-index: 7;
    background-image:
        linear-gradient(to right, rgba(0,0,0,0.4) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.4) 100%),
        repeating-linear-gradient(45deg, transparent, transparent 8px, rgba(0,0,0,0.2) 8px, rgba(0,0,0,0.2) 12px),
        repeating-linear-gradient(45deg, #a67c52, #a67c52 8px, #8b5a2b 8px, #8b5a2b 12px);
  }
  .rope-left { left: 2%; } .rope-right { right: 2%; }

  .rock { position: absolute; width: 40px; height: 35px; background: #777; border-radius: 40% 50% 30% 40%; border-bottom: 5px solid #555; z-index: 6; box-shadow: 0 5px 10px rgba(0,0,0,0.4); }
  .coin { position: absolute; width: 30px; height: 30px; background: gold; border-radius: 50%; border: 2px solid #DAA520; z-index: 7; box-shadow: 0 0 15px orange; animation: spin 0.6s infinite alternate ease-in-out; }
  @keyframes spin { from { transform: rotateY(0deg); } to { transform: rotateY(180deg); } }

  /* --- 6. UI --- */
  #effects-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 60; overflow: hidden; }
  .booster-text { position: absolute; font-family: 'Titan One', cursive; font-size: 45px; -webkit-text-stroke: 2px #333; text-shadow: 4px 4px 0 rgba(0,0,0,0.5); opacity: 0; white-space: nowrap; transform: translate(-50%, -50%); animation: popAndHover 2.5s ease-out forwards; }
  @keyframes popAndHover { 0% { opacity: 0; transform: translate(-50%, -20%) scale(0.5) rotate(-10deg); } 20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(3deg); } 40% { transform: translate(-50%, -50%) scale(1) rotate(-2deg); } 80% { opacity: 1; transform: translate(-50%, -60%) scale(1) rotate(1deg); } 100% { opacity: 0; transform: translate(-50%, -80%) scale(0.9); } }

  #countdown-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 150; display: none; justify-content: center; align-items: center; background: rgba(0,0,0,0.2); }
  .countdown-num { font-family: 'Titan One', cursive; font-size: 120px; color: #fff; -webkit-text-stroke: 4px #000; text-shadow: 0 10px 0 #333; animation: countPop 0.8s ease-out forwards; }
  @keyframes countPop { 0% { transform: scale(0.5); opacity: 0; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 0; } }

  .hud-pill { position: absolute; top: 20px; padding: 8px 15px; background: white; border-radius: 20px; font-family: 'Titan One', cursive; color: #ff6b6b; font-size: 20px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); z-index: 50; display: flex; align-items: center; gap: 8px; }
  #score-board { left: 20px; } #level-board { right: 20px; color: #4ecdc4; }
  .icon-coin { display: inline-block; width: 22px; height: 22px; background: gold; border-radius: 50%; text-align: center; line-height: 22px; font-size: 14px; color: #b8860b; border: 1px solid #b8860b; font-family: 'Titan One', cursive; }
  
  #game-controls { position: absolute; top: 75px; right: 20px; z-index: 50; display: none; flex-direction: row; gap: 10px; }
  .ctrl-btn { width: 45px; height: 45px; background: white; border-radius: 50%; border: none; box-shadow: 0 4px 0 rgba(0,0,0,0.1); font-family: 'Titan One', cursive; font-size: 18px; color: #555; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: transform 0.1s; padding-top: 4px; }
  .ctrl-btn:active { transform: translateY(3px); box-shadow: none; }
  #paused-msg { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-family: 'Titan One', cursive; font-size: 60px; color: white; text-shadow: 4px 4px 0 rgba(0,0,0,0.2); z-index: 90; display: none; pointer-events: none; letter-spacing: 2px; }

  /* --- 7. TURTLE --- */
  #player { position: absolute; bottom: 100px; left: 50%; width: 64px; height: 74px; transform: translateX(-50%); z-index: 20; transition: left 0.1s linear; filter: drop-shadow(0 8px 6px rgba(0,0,0,0.4)); }
  .turtle-anim-wrapper { width: 100%; height: 100%; position: relative; animation: swimBob 0.8s ease-in-out infinite; }
  @keyframes swimBob { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-4px) scale(1.03); } }
  :root { --t-skin: #b2e0a4; --t-skin-dark: #86b377; --t-blush: #FF69B4; --t-shell-base: #a98a69; }
  .t-shell { position: absolute; width: 56px; height: 62px; background: var(--t-shell-base); border-radius: 50%; top: 10px; left: 4px; z-index: 22; border: 3px solid #7f6348; overflow: hidden; }
  .f-decor { position: absolute; font-size: 16px; opacity: 1; }
  .f1 { top: 0; left: 5px; } .f2 { top: 0; right: 5px; } .f3 { top: 20px; left: 0; } .f4 { top: 20px; right: 0; } .f5 { bottom: 0; left: 5px; } .f6 { bottom: 0; right: 5px; }
  .t-head { position: absolute; width: 32px; height: 30px; background: var(--t-skin); border-radius: 50%; top: -8px; left: 50%; transform: translateX(-50%); z-index: 23; border: 2px solid var(--t-skin-dark); }
  .t-hat { position: absolute; top: -10px; left: 50%; transform: translateX(-50%) rotate(-5deg); width: 36px; height: 12px; background: #e0cda5; border-radius: 50% 50% 5px 5px; z-index: 24; border: 2px solid #b39c78; }
  .t-hat-band { position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: #ff6b6b; }
  .t-eye { position: absolute; width: 7px; height: 9px; background: black; border-radius: 50%; top: 10px; } .t-eye::after { content:''; position: absolute; top: 1px; left: 1px; width: 2px; height: 2px; background: white; border-radius: 50%; }
  .t-eye.left { left: 7px; } .t-eye.right { right: 7px; }
  .t-cheek { position: absolute; width: 8px; height: 6px; background: var(--t-blush); border-radius: 50%; top: 16px; opacity: 0.9; }
  .t-cheek.left { left: 3px; } .t-cheek.right { right: 3px; }
  .t-mouth { position: absolute; width: 8px; height: 4px; border-bottom: 2px solid #333; border-radius: 0 0 10px 10px; bottom: 8px; left: 50%; transform: translateX(-50%); }
  .t-flipper { position: absolute; width: 20px; height: 28px; background: var(--t-skin); border-radius: 50%; z-index: 20; border: 2px solid var(--t-skin-dark); }
  .t-flipper.front-l { top: 10px; left: -8px; transform: rotate(-35deg); } .t-flipper.front-r { top: 10px; right: -8px; transform: rotate(35deg); }
  .t-flipper.back-l { bottom: 4px; left: -2px; transform: rotate(-55deg); } .t-flipper.back-r { bottom: 4px; right: -2px; transform: rotate(55deg); }
  .t-tail { position: absolute; bottom: -2px; left: 50%; width: 10px; height: 15px; background: var(--t-skin); transform: translateX(-50%); border-radius: 50%; border: 2px solid var(--t-skin-dark); z-index: 20; }
  
  /* LASHES */
  .t-lashes .lash { position: absolute; background: #333; width: 6px; height: 2px; border-radius: 1px; top: -3px; }
  .t-lashes .lash:nth-child(1) { transform: rotate(-45deg); left: -4px; }
  .t-lashes .lash:nth-child(2) { transform: rotate(0deg); left: 0px; top: -5px; }
  .t-lashes .lash:nth-child(3) { transform: rotate(45deg); left: 4px; }
  .t-eye.right .t-lashes .lash:nth-child(1) { transform: rotate(-45deg); right: 4px; left:auto; }
  .t-eye.right .t-lashes .lash:nth-child(2) { transform: rotate(0deg); right: 0px; left:auto; }
  .t-eye.right .t-lashes .lash:nth-child(3) { transform: rotate(45deg); right: -4px; left:auto; }

  /* Emotions */
  .player-happy .t-mouth { height: 10px; width: 14px; background: #660000; border-radius: 5px 5px 20px 20px; border: none; }
  .player-happy .t-cheek { transform: scale(1.2); }
  .player-crying .t-mouth { height: 4px; width: 12px; border-bottom: none; border-top: 3px solid #333; border-radius: 10px 10px 0 0; bottom: 6px; }
  .player-crying .t-eye { height: 2px; width: 9px; border-radius: 0; background: #333; top: 12px; } .player-crying .t-eye::after { display: none; }
  .tear { position: absolute; width: 4px; height: 4px; background: #00BFFF; border-radius: 50% 50% 5px 5px; top: 14px; z-index: 30; display: none; }
  .player-crying .tear { display: block; animation: tearDrop 0.6s infinite; } .tear.right { right: 9px; animation-delay: 0.3s; } .tear.left { left: 9px; }

  /* --- 8. COVER PAGE --- */
  #intro-layer {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 200; display: flex; flex-direction: column; justify-content: center; align-items: center;
    background: transparent;
  }

  #cover-beach {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 45%;
    background: #F4A460; border-radius: 50% 50% 0 0 / 20px 20px 0 0;
    box-shadow: 0 -10px 20px rgba(0,0,0,0.1); z-index: 1;
    display: flex; justify-content: center; align-items: flex-end;
    overflow: hidden; transition: transform 1s ease-in-out;
  }
  .slide-down { transform: translateY(110%); }

  /* COVER TURTLE HERO - WANDERING ANIMATION */
  #cover-hero {
      position: absolute; left: 10%; top: 80%; transform: scale(1.8) rotate(-10deg); z-index: 5;
      animation: wanderingSwim 25s linear infinite;
  }
  @keyframes wanderingSwim {
      0% { left: 10%; top: 85%; transform: scale(1.8) rotate(-20deg); }
      20% { left: 40%; top: 60%; transform: scale(1.8) rotate(10deg); }
      40% { left: 85%; top: 20%; transform: scale(1.8) rotate(20deg); }
      45% { left: 90%; top: 15%; transform: scale(1.8) scaleX(-1) rotate(10deg); }
      65% { left: 50%; top: 40%; transform: scale(1.8) scaleX(-1) rotate(-10deg); }
      85% { left: 10%; top: 70%; transform: scale(1.8) scaleX(-1) rotate(-20deg); }
      95% { left: 5%; top: 80%; transform: scale(1.8) rotate(-20deg); }
      100% { left: 10%; top: 85%; transform: scale(1.8) rotate(-20deg); }
  }
  #cover-hero .front-l { animation: paddleFront 1.5s ease-in-out infinite; }
  #cover-hero .front-r { animation: paddleFront 1.5s ease-in-out infinite; }
  #cover-hero .back-l { animation: paddleBack 1.5s ease-in-out infinite; }
  #cover-hero .back-r { animation: paddleBack 1.5s ease-in-out infinite; }
  @keyframes paddleFront { 0%, 100% { transform: rotate(-35deg) scale(1); } 50% { transform: rotate(-55deg) scale(0.9); } }
  #cover-hero .front-r { animation-name: paddleFrontR; }
  @keyframes paddleFrontR { 0%, 100% { transform: rotate(35deg) scale(1); } 50% { transform: rotate(55deg) scale(0.9); } }
  @keyframes paddleBack { 0%, 100% { transform: rotate(-55deg); } 50% { transform: rotate(-35deg); } }
  #cover-hero .back-r { animation-name: paddleBackR; }
  @keyframes paddleBackR { 0%, 100% { transform: rotate(55deg); } 50% { transform: rotate(35deg); } }
  #cover-hero .t-eye { animation: eyeBlink 4s infinite; }
  @keyframes eyeBlink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }

  .game-logo { position: absolute; top: 15%; z-index: 10; display: flex; flex-direction: column; align-items: center; animation: logoFloat 3s ease-in-out infinite; }
  .logo-top { font-family: 'Titan One', cursive; font-size: 60px; color: #FFA500; text-shadow: 4px 4px 0 #8B4500; line-height: 0.8; }
  .logo-bottom { font-family: 'Titan One', cursive; font-size: 70px; color: #00BFFF; text-shadow: 4px 4px 0 #00688B; line-height: 0.9; }
  @keyframes logoFloat { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

  .menu-ui { position: absolute; bottom: 80px; z-index: 10; width: 80%; max-width: 300px; background: #DEB887; border: 4px solid #8B4513; border-radius: 15px; padding: 20px; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
  .input-nick { width: 90%; margin-bottom: 10px; border: 2px solid #8B4513; background: #FFF8DC; padding: 10px; border-radius: 5px; font-family:'Titan One'; text-align:center; color:#8B4513; outline:none; }
  .checkbox-group { display: flex; align-items: center; justify-content: center; font-size: 12px; color: #5e3210; margin-bottom: 10px; font-family: 'Sniglet'; font-weight: bold; }
  .btn-start { background: #76c043; color: white; border: 2px solid #fff; font-family: 'Titan One', cursive; font-size: 28px; padding: 10px 40px; border-radius: 50px; cursor: pointer; box-shadow: 0 6px 0 #4a802a; transition: transform 0.1s; display: block; margin: 0 auto; }
  .btn-start:active { transform: translateY(4px); box-shadow: 0 2px 0 #4a802a; }
  .btn-start:disabled { background: #999; box-shadow: 0 6px 0 #555; }

  /* AUTHOR STAGE */
  #author-stage {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 250; /* Topmost */
    display: none; flex-direction: column; justify-content: center; align-items: center;
    background: rgba(0,0,0,0.3);
  }
  .author-label { font-family: 'Sniglet', cursive; font-size: 28px; color: #fff; text-shadow: 2px 2px 0 #000; margin-bottom:10px; }
  .author-name { 
      font-family: 'Titan One', cursive; font-size: 70px; 
      color: #8B4513; /* BROWN */
      text-shadow: 4px 4px 0 #CD853F, -2px -2px 0 #FFF; 
      animation: popInName 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }
  @keyframes popInName { 0% { transform: scale(0.5); opacity:0; } 100% { transform: scale(1); opacity:1; } }

  .overlay-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; display: none; justify-content: center; align-items: center; flex-direction: column; }
  .final-score-val { font-family: 'Titan One', cursive; font-size: 60px; color: #e67e22; margin: 10px 0 20px 0; text-shadow: 3px 3px 0 rgba(0,0,0,0.1); }

</style>
</head>
<body>

<div id="game-container">
  
  <div id="sky-deco-layer"><div class="sun"></div><div class="cloud c1"></div><div class="cloud c2"></div><div class="cloud c3"></div></div>
  <div id="ocean-deco-layer"><div class="sun-reflection"></div><div class="wave-texture wave-texture-1"></div><div class="wave-texture wave-texture-2"></div><div class="little-fish f-type1 lf1"></div><div class="little-fish f-type2 lf2"></div><div class="little-fish f-type3 lf3"></div><div class="little-fish f-type1 lf4"></div></div>

  <div id="effects-layer"></div>
  <div id="score-board" class="hud-pill"><span class="icon-coin">$</span> <span id="score-val">0</span></div>
  <div id="level-board" class="hud-pill">Lvl <span id="level-val">1</span> <span class="star-deco">‚òÖ</span></div>

  <div id="game-controls">
    <button id="btn-pause" class="ctrl-btn" onclick="togglePause()">II</button>
    <button id="btn-resume" class="ctrl-btn" onclick="togglePause()">‚ñ∂</button>
    <button id="btn-restart" class="ctrl-btn" onclick="restartGame()">‚Üª</button>
  </div>
  <div id="paused-msg">PAUSED</div>

  <div id="countdown-layer"><div class="countdown-num" id="countdown-num"></div></div>

  <div id="bridge-area">
    <div class="rope rope-left"></div><div class="rope rope-right"></div>
    <div id="game-layer"></div>
    <div id="player">
        <div class="turtle-anim-wrapper">
            <div class="t-flipper front-l"></div><div class="t-flipper front-r"></div><div class="t-flipper back-l"></div><div class="t-flipper back-r"></div>
            <div class="t-tail"></div>
            <div class="t-shell"><span class="f-decor f1">üåª</span><span class="f-decor f2">üå∫</span><span class="f-decor f3">üåπ</span><span class="f-decor f4">üå∑</span><span class="f-decor f5">üåº</span><span class="f-decor f6">üå∏</span></div>
            <div class="t-head">
                <div class="t-hat"><div class="t-hat-band"></div></div>
                <div class="t-eyebrow left"></div><div class="t-eyebrow right"></div><div class="t-eye left"></div><div class="t-eye right"></div>
                <div class="tear left"></div><div class="tear right"></div><div class="t-cheek left"></div><div class="t-cheek right"></div><div class="t-mouth"></div>
            </div>
        </div>
    </div>
  </div>

  <div id="intro-layer">
    <div id="cover-beach">
        <div id="cover-hero">
             <div class="t-shell" style="width:60px; height:65px;"><span class="f-decor f1">üåª</span><span class="f-decor f2">üå∫</span></div>
             <div class="t-head" style="top:-10px; left:15px;">
                <div class="t-hat" style="top:-12px; width:40px;"><div class="t-hat-band"></div></div>
                <div class="t-eye left"><div class="t-lashes"><div class="lash"></div><div class="lash"></div><div class="lash"></div></div></div>
                <div class="t-eye right"><div class="t-lashes"><div class="lash"></div><div class="lash"></div><div class="lash"></div></div></div>
                <div class="t-mouth" style="height:10px; border-radius:0 0 20px 20px; background:#660000; border:none;"></div>
                <div class="t-cheek left"></div><div class="t-cheek right"></div>
             </div>
             <div class="t-flipper front-l" style="top:10px; left:-10px;"></div><div class="t-flipper front-r" style="top:10px; right:-10px;"></div>
             <div class="t-flipper back-l" style="bottom:0px; left:-5px;"></div><div class="t-flipper back-r" style="bottom:0px; right:-5px;"></div>
        </div>
    </div>

    <div id="cover-ui" style="position:absolute; width:100%; height:100%; display:flex; flex-direction:column; justify-content:space-between; align-items:center; padding:60px 0 40px 0; box-sizing:border-box;">
        <div class="game-logo"><div class="logo-top">TURTLE</div><div class="logo-bottom">RUSH</div></div>
        <div class="menu-ui">
            <input type="text" id="nickname-input" class="input-nick" placeholder="Nickname" maxlength="10">
            <label class="checkbox-group"><input type="checkbox" id="agree-check"> <span>Rules?</span></label>
            <button id="start-btn" class="btn-start" disabled>START</button>
        </div>
    </div>

    <div id="author-stage">
        <div class="author-label">Created by</div>
        <div class="author-name">Â•ßËè≤ÊÅ©</div>
    </div>
  </div>

  <div id="modal-overlay" class="overlay-layer">
    <div class="parchment" style="background:#DEB887; border:4px solid #8B4513; border-radius:15px; padding:30px; text-align:center;">
      <h2 style="font-family:'Titan One'; color:#8B4513;">Game Over</h2>
      <h1 style="font-family:'Titan One'; color:#c0392b; font-size:50px;">Splash!</h1>
      <div class="final-score-val" id="final-score">0</div>
      <button class="btn-start" onclick="restartGame()">Try Again</button>
    </div>
  </div>

</div>

<script>
  const config = { speed: 5, spawnRate: 60 };
  let state = { isPlaying: false, isPaused: false, score: 0, level: 1, frames: 0, playerLane: 1, elements: [], animId: null, nickname: "Player", isCrying: false };

  const gameLayer = document.getElementById('game-layer');
  const player = document.getElementById('player');
  const scoreEl = document.getElementById('score-val');
  const levelEl = document.getElementById('level-val');
  const finalScoreEl = document.getElementById('final-score');
  const modal = document.getElementById('modal-overlay');
  const effectsLayer = document.getElementById('effects-layer');
  const gameControls = document.getElementById('game-controls');
  const btnPause = document.getElementById('btn-pause');
  const btnResume = document.getElementById('btn-resume');
  const btnRestart = document.getElementById('btn-restart');
  const pausedMsg = document.getElementById('paused-msg');
  const countdownLayer = document.getElementById('countdown-layer');
  const countdownNum = document.getElementById('countdown-num');
  
  const introLayer = document.getElementById('intro-layer');
  const authorStage = document.getElementById('author-stage'); 
  const coverBeach = document.getElementById('cover-beach');
  const coverUI = document.getElementById('cover-ui');
  const nickInput = document.getElementById('nickname-input');
  const agreeCheck = document.getElementById('agree-check');
  const startBtn = document.getElementById('start-btn');

  const LANES = [15, 50, 85]; 

  /* AUDIO UPGRADE: LIVELY CALYPSO TUNE */
  let audioCtx;
  let bgmInterval;
  function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
  
  function playTone(freq, type, duration) {
    if(!audioCtx) return; if (audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
    osc.type = type; osc.frequency.value = freq; osc.connect(gain); gain.connect(audioCtx.destination);
    osc.start(); gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration); osc.stop(audioCtx.currentTime + duration);
  }

  function startBGM() {
      if(!audioCtx) return;
      if(audioCtx.state === 'suspended') audioCtx.resume();
      let noteIndex = 0;
      // Faster, syncopated Calypso feel
      const melody = [523.25, 0, 392.00, 0, 329.63, 349.23, 392.00, 0, 523.25, 523.25, 0, 392.00]; 
      
      clearInterval(bgmInterval);
      bgmInterval = setInterval(() => {
          if(state.isPaused || !state.isPlaying) return;
          const note = melody[noteIndex % melody.length];
          if(note > 0) {
              const osc = audioCtx.createOscillator();
              const gain = audioCtx.createGain();
              osc.type = 'square'; // Chiptune/Fun vibe
              osc.frequency.value = note;
              osc.connect(gain);
              gain.connect(audioCtx.destination);
              gain.gain.setValueAtTime(0.05, audioCtx.currentTime); // Gentle volume
              gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); // Short staccato
              osc.start(); osc.stop(audioCtx.currentTime + 0.1);
          }
          noteIndex++;
      }, 150); // Fast tempo
  }
  function stopBGM() { clearInterval(bgmInterval); }

  /* Auto-play Attempt on Load/Interaction */
  function tryAudioStart() {
      initAudio();
      if(audioCtx.state === 'suspended') {
          const unlock = () => { 
              audioCtx.resume().then(() => {
                  startBGM(); // Start music on cover page if desired, or wait for game start
                  // For cover page music, uncomment above line. 
                  // User asked for lively background audio "when I open the code".
                  startBGM();
                  document.removeEventListener('click', unlock);
                  document.removeEventListener('touchstart', unlock);
                  document.removeEventListener('keydown', unlock);
              });
          };
          document.addEventListener('click', unlock);
          document.addEventListener('touchstart', unlock);
          document.addEventListener('keydown', unlock);
      } else {
          startBGM();
      }
  }
  // Try to start music immediately (or on first click)
  tryAudioStart();


  /* HELPERS */
  function setFace(mood) {
    player.classList.remove('player-happy', 'player-crying');
    if (mood === 'happy') player.classList.add('player-happy');
    if (mood === 'crying') player.classList.add('player-crying');
  }

  const BOOSTER_WORDS = ["Awesome!", "Great!", "Speed Up!", "Cool!", "Wow!"];
  const BOOSTER_COLORS = ["#FFD700", "#7FFF00", "#00FFFF", "#FF69B4"];
  function triggerBooster() {
    const word = BOOSTER_WORDS[Math.floor(Math.random() * BOOSTER_WORDS.length)];
    const color = BOOSTER_COLORS[Math.floor(Math.random() * BOOSTER_COLORS.length)];
    const el = document.createElement('div'); el.className = 'booster-text'; el.innerText = word; el.style.color = color;
    const randomLeft = 20 + Math.random() * 60; const randomTop = 20 + Math.random() * 30;  
    el.style.left = randomLeft + '%'; el.style.top = randomTop + '%';
    effectsLayer.appendChild(el); setFace('happy');
    setTimeout(() => { el.remove(); if(!state.isCrying) setFace('normal'); }, 2500);
  }

  /* --- APP FLOW --- */
  function initApp() {
    nickInput.addEventListener('input', checkValidation);
    agreeCheck.addEventListener('change', checkValidation);
    
    startBtn.addEventListener('click', () => { 
        state.nickname = nickInput.value; 
        
        // 1. Slide Beach Down & Fade UI
        coverBeach.classList.add('slide-down');
        coverUI.style.opacity = '0'; coverUI.style.transition = 'opacity 0.5s';
        
        // 2. Show Author after cover leaves
        setTimeout(() => {
            coverUI.style.display = 'none';
            authorStage.style.display = 'flex';
        }, 800);

        // 3. Hide Author & Start Game
        setTimeout(() => {
            introLayer.style.display = 'none';
            restartGame(); 
        }, 3000); 
    });
  }

  function checkValidation() {
    if (nickInput.value.trim().length > 0 && agreeCheck.checked) startBtn.disabled = false; else startBtn.disabled = true;
  }

  function runCountdown() {
    countdownLayer.style.display = 'flex';
    let count = 3;
    const tick = () => {
        if(count > 0) {
            countdownNum.innerText = count;
            countdownNum.classList.remove('countdown-num'); void countdownNum.offsetWidth; countdownNum.classList.add('countdown-num');
            playTone(600, 'sine', 0.1); count--; setTimeout(tick, 1000);
        } else {
            countdownNum.innerText = "GO!";
            countdownNum.classList.remove('countdown-num'); void countdownNum.offsetWidth; countdownNum.classList.add('countdown-num');
            playTone(800, 'square', 0.3); setTimeout(() => { countdownLayer.style.display = 'none'; startGame(); }, 1000);
        }
    };
    tick();
  }

  /* GAME LOGIC */
  function movePlayer(direction) {
    if (!state.isPlaying || state.isPaused || state.isCrying) return; 
    state.playerLane += direction;
    if (state.playerLane < 0) state.playerLane = 0; if (state.playerLane > 2) state.playerLane = 2;
    updatePlayerPos();
  }
  function updatePlayerPos() { player.style.left = LANES[state.playerLane] + '%'; }

  function togglePause() {
    if (!state.isPlaying || state.isCrying) return;
    state.isPaused = !state.isPaused;
    if (state.isPaused) {
      cancelAnimationFrame(state.animId); btnPause.style.display = 'none'; btnResume.style.display = 'flex'; btnRestart.style.display = 'flex'; pausedMsg.style.display = 'block';
      stopBGM(); // Stop music on pause
    } else {
      loop(); btnPause.style.display = 'flex'; btnResume.style.display = 'none'; btnRestart.style.display = 'none'; pausedMsg.style.display = 'none';
      startBGM(); // Resume music
    }
  }

  function restartGame() {
    modal.style.display = 'none';
    btnPause.style.display = 'flex'; btnResume.style.display = 'none'; btnRestart.style.display = 'none'; pausedMsg.style.display = 'none';
    gameControls.style.display = 'none'; 
    state.isPaused = false; state.isCrying = false; 
    gameLayer.innerHTML = ''; effectsLayer.innerHTML = '';
    scoreEl.innerText = "0"; levelEl.innerText = "1"; setFace('normal');
    state.playerLane = 1; updatePlayerPos();
    startBGM(); // Ensure music plays
    runCountdown();
  }

  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') movePlayer(-1); if (e.key === 'ArrowRight') movePlayer(1);
    if (e.key === ' ' && state.isPlaying) togglePause();
  });
  document.addEventListener('touchstart', (e) => {
    if (!state.isPlaying || state.isPaused || state.isCrying) return; 
    if(e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT') return;
    const touchX = e.touches[0].clientX; const screenW = window.innerWidth;
    if (touchX < screenW / 2) movePlayer(-1); else movePlayer(1);
  });

  function startGame() {
    state.isPlaying = true; state.isPaused = false; state.isCrying = false; state.score = 0; state.level = 1; state.speed = 5; state.elements = []; state.frames = 0;
    gameControls.style.display = 'flex'; loop();
  }

  function loop() {
    if (!state.isPlaying || state.isPaused) return;
    state.frames++;
    if (state.frames % config.spawnRate === 0) spawnRow();
    if (state.frames % 500 === 0) {
      state.level++; state.speed += 0.5; levelEl.innerText = state.level; triggerBooster(); 
    }
    moveElements(); checkCollisions();
    state.animId = requestAnimationFrame(loop);
  }

  function spawnRow() {
    let isMoving = false; let moveSpeed = 0;
    if (state.level >= 3 && Math.random() > 0.5) {
        isMoving = true; moveSpeed = 0.5 + (state.level * 0.1); moveSpeed *= Math.random() > 0.5 ? 1 : -1;
    }
    state.elements.push({ type: 'rowMarker', y: -50 });

    const rng = Math.random(); const lane = Math.floor(Math.random() * 3); 
    if (rng > 0.6) {
      const rock = document.createElement('div'); rock.className = 'rock';
      let initialX = LANES[lane]; rock.style.left = initialX + '%'; rock.style.top = '-50px';
      gameLayer.appendChild(rock); 
      state.elements.push({ type: 'rock', el: rock, y: -50, lane: lane, isMoving: isMoving, x: initialX, speedX: moveSpeed });
    } else if (rng > 0.3) {
      const coin = document.createElement('div'); coin.className = 'coin';
      coin.style.left = (LANES[lane] - 4) + '%'; coin.style.top = '-50px';
      coin.innerText = '$'; coin.style.display = 'flex'; coin.style.justifyContent = 'center'; coin.style.alignItems = 'center'; coin.style.fontSize = '12px'; coin.style.color = '#b8860b';
      gameLayer.appendChild(coin); state.elements.push({ type: 'coin', el: coin, y: -50, lane: lane });
    }
  }

  function moveElements() {
    state.elements = state.elements.filter(item => {
      item.y += state.speed; 
      if(item.el) item.el.style.top = item.y + 'px';

      if (item.type === 'rock' && item.isMoving) {
          item.x += item.speedX;
          if (item.x < 15 || item.x > 85) { item.speedX *= -1; }
          item.el.style.left = item.x + '%';
      }
      if (item.y > window.innerHeight) {
        if(item.el) item.el.remove();
        if (item.type === 'rowMarker') { state.score += 1; scoreEl.innerText = state.score; }
        return false;
      }
      return true;
    });
  }

  function checkCollisions() {
    const turtleShell = player.querySelector('.t-shell'); const playerRect = turtleShell.getBoundingClientRect();
    for (let i = state.elements.length - 1; i >= 0; i--) {
      const item = state.elements[i]; 
      if(!item.el) continue;
      const itemRect = item.el.getBoundingClientRect();
      if ( playerRect.left < itemRect.right && playerRect.right > itemRect.left && playerRect.top < itemRect.bottom && playerRect.bottom > itemRect.top ) {
        if (item.type === 'rock') { triggerGameOverSequence(); } 
        else if (item.type === 'coin') {
          state.score += 50; scoreEl.innerText = state.score; item.el.remove(); state.elements.splice(i, 1);
        }
      }
    }
  }

  function triggerGameOverSequence() {
    state.isPlaying = false; state.isCrying = true; cancelAnimationFrame(state.animId);
    setFace('crying'); gameControls.style.display = 'none'; 
    stopBGM(); // Stop music on death
    setTimeout(() => { showGameOverModal(); }, 2000);
  }

  function showGameOverModal() {
    finalScoreEl.innerText = state.score; modal.style.display = 'flex';
  }

  initApp();
</script>
</body>
</html> 